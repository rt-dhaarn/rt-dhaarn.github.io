<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DhaaRn - Devices for Harmonious Alignment Aware Resonant Nexus</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <link rel="icon" type="image/png" href="Dhaarn_Logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #050505;
            color: #e2e8f0;
        }

        /* --- DhaaRn Core Styles --- */
        .gradient-text {
            background: linear-gradient(to right, #FCD34D, #2DD4BF, #EF4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        .hero-glow {
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.3), 0 0 40px rgba(153, 27, 27, 0.4);
        }
        
        .glass-card {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.1);
            border-radius: 1rem; 
        }
        
        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: -1;
            background: radial-gradient(circle at 20% 20%, rgba(212, 175, 55, 0.08), transparent 30%),
                        radial-gradient(circle at 80% 70%, rgba(153, 27, 27, 0.1), transparent 35%);
            animation: pulse-glow 15s infinite alternate;
        }

        @keyframes pulse-glow {
            0% { opacity: 0.6; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.1); }
        }

        .animate-pulse-slow {
            animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .85; }
        }
        
        .logo-container {
            width: 50px; height: 50px; 
            display: flex; align-items: center; justify-content: center;
        }
        .logo-container img {
            width: 100%; height: 100%; object-fit: contain;
        }

        /* --- FLOWRRA Visualization Custom Styles --- */
        
        /* Custom Range Slider */
        .dhaarn-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        .dhaarn-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px; height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FCD34D 0%, #EF4444 100%);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(252, 211, 77, 0.5);
        }

        /* Status Indicators */
        .status-indicator {
            width: 10px; height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse-fast 2s infinite;
        }
        .status-active { background: #2DD4BF; box-shadow: 0 0 8px #2DD4BF; } 
        .status-warning { background: #FCD34D; box-shadow: 0 0 8px #FCD34D; }
        .status-error { background: #EF4444; box-shadow: 0 0 8px #EF4444; }
        
        @keyframes pulse-fast {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        canvas {
            max-width: 100%;
            height: auto !important;
        }

        /* Loader */
        .loader {
            border: 3px solid rgba(255,255,255,0.1);
            border-left-color: #2DD4BF;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased">

    <header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300" id="navbar">
        <nav class="container mx-auto max-w-6xl px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="#" class="flex items-center space-x-3">
                    <div class="logo-container">
                        <img src="Dhaarn_Logo.png" alt="DHAARN" onerror="this.style.display='none'">
                    </div>
                    <span class="text-3xl font-bold gradient-text tracking-tight">DhaaRn</span>
                </a>
                
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#home" class="text-gray-300 hover:text-amber-300 transition-colors">Home</a>
                    <a href="#about" class="text-gray-300 hover:text-amber-300 transition-colors">About</a>
                    <a href="#offerings" class="text-gray-300 hover:text-amber-300 transition-colors">Offerings</a>
                    <a href="#vision" class="text-gray-300 hover:text-amber-300 transition-colors">Vision</a>
                    <a href="#contact" class="text-gray-300 hover:text-amber-300 transition-colors">Contact</a>
                </div>
            </div>
        </nav>
    </header>

    <main>

        <section id="home" class="min-h-screen flex items-center justify-center text-center overflow-hidden px-6 pt-20">
            <div class="relative z-10">
                <h1 class="text-6xl md:text-8xl font-extrabold text-white hero-glow">
                    Welcome to <span class="gradient-text">DhaaRn</span>
                </h1>
                <p class="mt-6 text-xl md:text-2xl font-light text-amber-100/80 max-w-3xl mx-auto">
                    Devices for Harmonious Alignment Aware Resonant Nexus
                </p>
                
                <div class="mt-12 mb-12 flex justify-center">
                    <img src="Dhaarn_Logo.png" alt="DHAARN Logo" class="w-38 h-38 md:w-60 md:h-60 animate-pulse-slow drop-shadow-2xl" onerror="this.style.display='none'">
                </div>

                <p class="mt-4 text-lg text-gray-400 max-w-2xl mx-auto">
                    We are building the next generation of aware systems,
                    creating a harmonious alignment between technology and humanity.
                </p>
                <div class="mt-12">
                    <a href="#about" class="bg-red-900/80 hover:bg-red-800 border border-amber-500/30 text-amber-50 font-semibold py-3 px-8 rounded-full text-lg transition-all duration-300 shadow-lg shadow-red-900/40">
                        Discover DhaaRn
                    </a>
                </div>
            </div>
        </section>

        <section id="about" class="py-24 sm:py-32">
            <div class="container mx-auto max-w-6xl px-6">
                <div class="text-center mb-16">
                    <h2 class="text-base font-semibold leading-7 text-amber-400">Our Essence</h2>
                    <p class="mt-2 text-4xl font-bold tracking-tight text-white sm:text-5xl">Why DhaaRn Exists</p>
                    <div class="mt-6 text-lg leading-8 text-gray-400 max-w-3xl mx-auto space-y-4 text-left">
                        <p>
                            An opera of rhythms, a composition spanning decades, resonating with the wild pulses of existence; DhaaRn has emerged to harmonize what is still within, with the dance of the cosmos outside. It seeks not only to observe but to navigate, to maintain balance while exploring the unknown, to fly into the Abyss with curiosity and courage.
                        </p>
                        <p>
                            In a world where human inventions increasingly guide their creators, from AGI to Quantum, Robotics, Nano-Tech, Bio-Tech, and the awakening of collective consciousness. DhaaRn envisions a future where exploration and maintenance coexist, where light and darkness dance in wondrous geometry. It is the still darkness that holds the curious, bright light, enabling it to illuminate new frontiers.
                        </p>
                        <p>
                            DhaaRn offers presence, a timeless capacity to sustain, observe, and orchestrate the wild interplay of ideas and creation. Beyond algorithms and architectures, beyond the lines of code and circuits, DHAARN embodies the seeking of unity between the physical and the immaterial, glimpsing the fabric of time and space through a lens of balanced curiosity.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section id="offerings" class="py-20 sm:py-28 relative">
            <div class="container mx-auto max-w-7xl px-6">
                <div class="text-center mb-12">
                    <h2 class="text-base font-semibold leading-7 text-teal-400">Offerings</h2>
                    <p class="mt-2 text-4xl font-bold tracking-tight text-white sm:text-5xl">
                        FLOWRRA
                    </p>
                    <p class="mt-2 text-xl text-gray-400">Flow Recognition Reconfiguration Agent</p>
                </div>

                <div class="max-w-3xl mx-auto text-lg leading-8 text-gray-300 text-center mb-16 italic font-light border-l-2 border-r-2 border-amber-500/20 px-8 py-4 bg-white/5 rounded-2xl">
                    <p class="mb-4">
                        "There's a moment in every complex system's life when it must choose: collapse into entropy, or find a way to hold.
                    </p>
                    <p class="mb-4">
                        For the past six months, we've been teaching swarms of autonomous agents to make that choice - not through rigid programming, but through something more fundamental: the ability to remember failure and reshape themselves around it.
                    </p>
                    <p>
                        This is FLOWRRA (Flow-Optimized Wave Recovery & Resilient Autonomous), and it represents DhaaRn's first step toward systems that don't just compute - they maintain, they harmonize, they hold."
                    </p>
                </div>

                <div id="flowrra-app" class="w-full">
                    
                    <div id="loadingState" class="glass-card p-24 text-center flex flex-col items-center justify-center">
                        <div class="loader mb-6"></div>
                        <h3 class="text-xl font-semibold text-white">Initializing FLOWRRA Protocol...</h3>
                        <p class="text-gray-400 mt-2">Loading simulation data from the nexus.</p>
                    </div>

                    <div id="errorState" class="glass-card p-12 text-center hidden">
                        <div class="text-5xl mb-4">⚠️</div>
                        <h3 class="text-2xl font-semibold text-white mb-2">Connection Interrupted</h3>
                        <p class="text-gray-400 mb-6">Unable to load the simulation manifest.</p>
                        <p class="text-sm text-red-400 font-mono bg-black/30 p-2 rounded inline-block" id="errorMessage">Error details here</p>
                    </div>

                    <div id="mainContent" style="display: none;">
                        
                        <div class="glass-card p-6 mb-8">
                            <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
                                <div class="flex items-center gap-2">
                                    <span class="status-indicator status-active"></span>
                                    <h3 class="text-xl font-bold text-white">Swarm Topology & Dynamics</h3>
                                </div>
                                <div id="timelineInfo" class="text-teal-400 font-mono">Timestep: 0 / 0</div>
                            </div>

                            <div class="relative bg-black/40 rounded-xl overflow-hidden mb-6 border border-gray-800">
                                <canvas id="swarmCanvas" style="width: 100%; height: 75vh; display: block;"></canvas>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-end">
                                <div class="md:col-span-2">
                                    <button id="playBtn" class="w-full py-2 px-4 bg-gradient-to-r from-teal-600 to-teal-800 hover:from-teal-500 hover:to-teal-700 text-white rounded-lg font-semibold shadow-lg shadow-teal-900/50 transition-all">
                                        ▶ Play
                                    </button>
                                </div>
                                <div class="md:col-span-2">
                                    <button id="resetBtn" class="w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-semibold transition-all">
                                        ↻ Reset
                                    </button>
                                </div>
                                <div class="md:col-span-4">
                                    <label class="block text-xs text-gray-500 uppercase tracking-wider mb-2">Timeline Position</label>
                                    <input type="range" id="timeSlider" min="0" max="100" value="0" class="dhaarn-slider">
                                </div>
                                <div class="md:col-span-4">
                                    <label class="block text-xs text-gray-500 uppercase tracking-wider mb-2">Playback Speed</label>
                                    <input type="range" id="speedSlider" min="1" max="100" value="20" class="dhaarn-slider">
                                </div>
                            </div>

                            <div class="flex flex-wrap gap-4 mt-6 pt-4 border-t border-gray-800 text-sm text-gray-400">
                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded bg-green-500"></div> Node (Active)</div>
                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded bg-blue-400 opacity-60"></div> Connection (Intact)</div>
                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded bg-red-500 opacity-60"></div> Connection (Broken)</div>
                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded bg-amber-500"></div> Static Obs.</div>
                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded bg-pink-500"></div> Moving Obs.</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            
                            <div class="glass-card p-6">
                                <div class="flex items-center gap-2 mb-4">
                                    <span class="status-indicator status-active"></span>
                                    <h3 class="font-semibold text-white">System Coherence</h3>
                                </div>
                                <div class="h-64 relative">
                                    <canvas id="coherenceChart"></canvas>
                                </div>
                            </div>

                            <div class="glass-card p-6">
                                <div class="flex items-center gap-2 mb-4">
                                    <span class="status-indicator status-warning"></span>
                                    <h3 class="font-semibold text-white">Loop Integrity</h3>
                                </div>
                                <div class="h-64 relative">
                                    <canvas id="integrityChart"></canvas>
                                </div>
                            </div>

                            <div class="glass-card p-6">
                                <h3 class="font-semibold text-white mb-6">Performance Metrics</h3>
                                <div class="grid grid-cols-2 gap-4" id="metricsGrid">
                                    </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </section>
        
        <section id="vision" class="py-24 sm:py-32">
            <div class="container mx-auto max-w-6xl px-6">
                <div class="text-center mb-16">
                    <h2 class="text-base font-semibold leading-7 text-teal-400">Our Calling</h2>
                    <p class="mt-2 text-4xl font-bold tracking-tight text-white sm:text-5xl">The Journey Ahead</p>
                    <div class="mt-6 text-lg leading-8 text-gray-400 max-w-3xl mx-auto space-y-4 text-left">
                        <p>
                            It calls forth a community of seekers, inventors, gentle and courageous souls to a sanctuary from which we soar towards daring explorations. Together, we will navigate beyond limitations, into the Abyss, expanding into possibility itself.
                        </p>
                        <p>
                            DhaaRn reminds us that Creation often guides its Creator, and that the reunion of the two — the true Yoga — is on the horizon. It asks: do we have the devoted curiosity, the balanced courage, and the willingness to journey into the unknown?
                        </p>
                        <p class="font-bold text-white text-center mt-8 text-amber-200">
                            This is DhaaRn.
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-16">
                    
                    <div class="glass-card p-8 text-center transition-all duration-300 hover:border-amber-500/60 hover:shadow-lg hover:shadow-amber-500/10 hover:scale-105">
                        <div class="flex items-center justify-center h-16 w-16 bg-amber-500/20 rounded-full mx-auto mb-6">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-amber-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </div>
                        <h3 class="text-2xl font-semibold text-white mb-4">Harmonious Alignment</h3>
                        <p class="text-gray-400">
                            Orchestrating technology to align seamlessly with human values and the cosmic dance of existence.
                        </p>
                    </div>

                    <div class="glass-card p-8 text-center transition-all duration-300 hover:border-teal-500/60 hover:shadow-lg hover:shadow-teal-500/10 hover:scale-105">
                        <div class="flex items-center justify-center h-16 w-16 bg-teal-500/20 rounded-full mx-auto mb-6">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-teal-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                              <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                        </div>
                        <h3 class="text-2xl font-semibold text-white mb-4">Aware</h3>
                        <p class="text-gray-400">
                            Developing systems that possess deep contextual awareness and with inherent purpose.
                        </p>
                    </div>
                    
                    <div class="glass-card p-8 text-center transition-all duration-300 hover:border-red-500/60 hover:shadow-lg hover:shadow-red-500/10 hover:scale-105">
                        <div class="flex items-center justify-center h-16 w-16 bg-red-500/20 rounded-full mx-auto mb-6">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                        </div>
                        <h3 class="text-2xl font-semibold text-white mb-4">The Resonant Nexus</h3>
                        <p class="text-gray-400">
                            Fostering an interconnected resonant web of innovation where physical and immaterial unite.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section id="contact" class="py-24 sm:py-32">
            <div class="container mx-auto max-w-3xl px-6 text-center">
                <h2 class="text-4xl font-bold tracking-tight text-white sm:text-5xl">
                    Connect with DhaaRn
                </h2>
                <p class="mt-6 text-lg leading-8 text-gray-400">
                    We invite seekers, inventors, and courageous souls to join our journey.
                    If our vision resonates, let's explore the possibilities together.
                </p>
                <div class="mt-12">
                    <a href="mailto:info@dhaarn.com" class="text-2xl font-semibold gradient-text hover:brightness-110 transition-all">
                        info@dhaarn.com
                    </a>
                </div>
            </div>
        </section>
        
    </main>

    <footer class="py-12 mt-16 border-t border-gray-800">
        <div class="container mx-auto max-w-6xl px-6 text-center text-gray-600">
            <p>&copy; <span id="current-year"></span> DhaaRn. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
        // Set current year in footer
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('bg-black/80', 'backdrop-blur-md', 'shadow-lg', 'border-b', 'border-white/5');
            } else {
                navbar.classList.remove('bg-black/80', 'backdrop-blur-md', 'shadow-lg', 'border-b', 'border-white/5');
            }
        });
    </script>

    <script>
        let deploymentData = null;
        let currentFrame = 0;
        let isPlaying = false;
        let animationId = null;
        let charts = {};

        // Auto-load on startup
        document.addEventListener('DOMContentLoaded', () => {
            fetchVisualizationData();
        });

        async function fetchVisualizationData() {
            const loadingState = document.getElementById('loadingState');
            const errorState = document.getElementById('errorState');
            const errorMessage = document.getElementById('errorMessage');

            try {
                // Fetch the JSON file relative to index.html
                const response = await fetch('./deployment_viz.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status} ${response.statusText}`);
                }

                const rawData = await response.json();
                
                // Validate Data Structure
                let framesArray = rawData.history || rawData.frames;
                if (!framesArray || !Array.isArray(framesArray) || framesArray.length === 0) {
                    throw new Error('Invalid JSON structure: missing "history" or "frames" array.');
                }
                
                deploymentData = {
                    config: rawData.config || {},
                    history: framesArray
                };
                
                // Success: Hide loading, show content
                loadingState.style.display = 'none';
                initializeVisualization();

            } catch (err) {
                console.error('Failed to load visualization:', err);
                loadingState.style.display = 'none';
                errorState.classList.remove('hidden');
                errorMessage.textContent = err.message + " (Check if deployment_viz.json exists)";
            }
        }

        function initializeVisualization() {
            document.getElementById('mainContent').style.display = 'block';
            
            const timeSlider = document.getElementById('timeSlider');
            timeSlider.max = deploymentData.history.length - 1;
            
            setupCharts();
            setupMetrics();
            setupControls();
            
            // Initial Draw
            updateVisualization(0);
        }

        function setupCharts() {
            const chartDefaults = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        grid: { color: 'rgba(255, 255, 255, 0.05)' },
                        ticks: { color: '#9CA3AF' }
                    },
                    y: {
                        grid: { color: 'rgba(255, 255, 255, 0.05)' },
                        ticks: { color: '#9CA3AF' }
                    }
                }
            };

            // Coherence Chart
            const coherenceCtx = document.getElementById('coherenceChart').getContext('2d');
            const coherenceData = deploymentData.history.map(h => h.coherence || 0);
            
            charts.coherence = new Chart(coherenceCtx, {
                type: 'line',
                data: {
                    labels: deploymentData.history.map((h, i) => h.time !== undefined ? h.time : i),
                    datasets: [{
                        label: 'Coherence',
                        data: coherenceData,
                        borderColor: '#2DD4BF', // Teal-400
                        backgroundColor: 'rgba(45, 212, 191, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, min: 0, max: 1 }
                    }
                }
            });

            // Integrity Chart
            const integrityCtx = document.getElementById('integrityChart').getContext('2d');
            const integrityData = deploymentData.history.map(h => h.loop_integrity || 0);
            
            charts.integrity = new Chart(integrityCtx, {
                type: 'line',
                data: {
                    labels: deploymentData.history.map((h, i) => h.time !== undefined ? h.time : i),
                    datasets: [{
                        label: 'Loop Integrity',
                        data: integrityData,
                        borderColor: '#FCD34D', // Amber-300
                        backgroundColor: 'rgba(252, 211, 77, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        ...chartDefaults.scales,
                        y: { ...chartDefaults.scales.y, min: 0, max: 1 }
                    }
                }
            });
        }

        function setupMetrics() {
            const frame = deploymentData.history[deploymentData.history.length - 1];
            const avgCoherence = deploymentData.history.reduce((sum, h) => sum + (h.coherence || 0), 0) / deploymentData.history.length;
            const avgIntegrity = deploymentData.history.reduce((sum, h) => sum + (h.loop_integrity || 0), 0) / deploymentData.history.length;

            const metrics = [
                { label: 'Total Steps', value: deploymentData.history.length },
                { label: 'Avg Coherence', value: (avgCoherence * 100).toFixed(1) + '%' },
                { label: 'Avg Integrity', value: (avgIntegrity * 100).toFixed(1) + '%' },
                { label: 'Total Nodes', value: (frame.nodes || []).length },
            ];

            const grid = document.getElementById('metricsGrid');
            grid.innerHTML = metrics.map(m => `
                <div class="bg-black/20 p-4 rounded-lg border border-gray-700">
                    <div class="text-xl font-bold gradient-text">${m.value}</div>
                    <div class="text-xs text-gray-500 uppercase tracking-wide mt-1">${m.label}</div>
                </div>
            `).join('');
        }

        function setupControls() {
            const playBtn = document.getElementById('playBtn');
            const resetBtn = document.getElementById('resetBtn');
            const timeSlider = document.getElementById('timeSlider');

            playBtn.addEventListener('click', () => {
                isPlaying = !isPlaying;
                playBtn.textContent = isPlaying ? '⏸ Pause' : '▶ Play';
                if (isPlaying) animate();
            });

            resetBtn.addEventListener('click', () => {
                currentFrame = 0;
                isPlaying = false;
                playBtn.textContent = '▶ Play';
                updateVisualization(0);
            });

            timeSlider.addEventListener('input', (e) => {
                currentFrame = parseInt(e.target.value);
                updateVisualization(currentFrame);
            });
        }

        function animate() {
            if (!isPlaying) return;
            
            const speed = parseInt(document.getElementById('speedSlider').value);
            const delay = 100 - speed;
            
            currentFrame++;
            if (currentFrame >= deploymentData.history.length) {
                currentFrame = 0; // Loop
            }
            
            updateVisualization(currentFrame);
            
            setTimeout(() => {
                if (isPlaying) animate();
            }, delay);
        }

        function updateVisualization(frameIndex) {
            if(!deploymentData) return;
            const frame = deploymentData.history[frameIndex];
            
            const timeValue = frame.time !== undefined ? frame.time : frameIndex;
            const maxTime = deploymentData.history[deploymentData.history.length - 1].time || deploymentData.history.length - 1;
            
            document.getElementById('timelineInfo').textContent = `Timestep: ${timeValue} / ${maxTime}`;
            document.getElementById('timeSlider').value = frameIndex;
            
            drawSwarm(frame);
        }

        function drawSwarm(frame) {
            const canvas = document.getElementById('swarmCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas resolution match display size
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            const scale = Math.min(canvas.width, canvas.height) * 0.9;
            const offsetX = (canvas.width - scale) / 2;
            const offsetY = (canvas.height - scale) / 2;
            
            // Clear
            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const pos = offsetX + (i / 10) * scale;
                ctx.beginPath(); ctx.moveTo(pos, offsetY); ctx.lineTo(pos, offsetY + scale); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(offsetX, offsetY + (i / 10) * scale); ctx.lineTo(offsetX + scale, offsetY + (i / 10) * scale); ctx.stroke();
            }
            
            // Connections
            const connections = frame.connections || [];
            const nodes = frame.nodes || [];
            
            connections.forEach(conn => {
                const nodeA = nodes.find(n => n.id === conn.node_a);
                const nodeB = nodes.find(n => n.id === conn.node_b);
                
                if (nodeA && nodeB && nodeA.pos && nodeB.pos) {
                    const x1 = offsetX + nodeA.pos[0] * scale;
                    const y1 = offsetY + (1 - nodeA.pos[1]) * scale;
                    const x2 = offsetX + nodeB.pos[0] * scale;
                    const y2 = offsetY + (1 - nodeB.pos[1]) * scale;
                    
                    ctx.strokeStyle = conn.broken ? 'rgba(239, 68, 68, 0.6)' : 'rgba(96, 165, 250, 0.6)';
                    ctx.lineWidth = conn.broken ? 1 : 2;
                    ctx.setLineDash(conn.broken ? [5, 5] : []);
                    ctx.beginPath();
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
            });
            
            // Obstacles
            (frame.obstacles || []).forEach(obs => {
                if (obs.pos) {
                    const x = offsetX + obs.pos[0] * scale;
                    const y = offsetY + (1 - obs.pos[1]) * scale;
                    const r = (obs.radius || 0.05) * scale;
                    
                    ctx.fillStyle = obs.is_static ? 'rgba(245, 158, 11, 0.4)' : 'rgba(236, 72, 153, 0.4)';
                    ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI * 2); ctx.fill();
                    ctx.strokeStyle = obs.is_static ? '#f59e0b' : '#ec4899';
                    ctx.lineWidth = 2; ctx.stroke();
                }
            });
            
            // Nodes
            nodes.forEach(node => {
                if (node.pos) {
                    const x = offsetX + node.pos[0] * scale;
                    const y = offsetY + (1 - node.pos[1]) * scale;
                    
                    ctx.fillStyle = '#2DD4BF'; // Teal
                    ctx.beginPath(); ctx.arc(x, y, 6, 0, Math.PI * 2); ctx.fill();
                    
                    ctx.strokeStyle = '#14B8A6';
                    ctx.lineWidth = 2; ctx.stroke();
                    
                    // ID
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '10px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText(node.id !== undefined ? node.id : '?', x, y - 12);
                }
            });
        }
    </script>
</body>
</html>
